{% extends 'base.html' %}
{% load static %}

{% block css %}
    <title>{{ note.title }}</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/simplemde/latest/simplemde.min.css">
    <link rel="stylesheet" href="{% static 'noteapp/css/note.css' %}"/>
    <link rel="stylesheet" href="{% static 'noteapp/css/simplemde.css' %}">

    {% include 'note_text_changer.html' %}

    <script src="https://cdn.jsdelivr.net/simplemde/latest/simplemde.min.js"></script>



{% endblock %}

{% block content %}

    {% include 'note_panel.html' with mode="edit" %}

    <!-- заметка -->
    <div class="note-block">
        <div class="note-info-container">
            <div class="note-image">
                <img
                        class="circled-icon note-icon"
                        src="
                                {% if note.icon %}{{ note.icon.url }}{% else %}{% static 'noteapp/default/default-note-icon.png' %}{% endif %}"
                        alt="Заметка"
                />
            </div>

            <div class="note-info">
                <div class="note-title">
                    <h2>{{ note.title }}</h2>
                </div>

                {% if note.description %}
                    <div class="note-description">
                        <p>{{ note.description }}</p>
                    </div>
                {% endif %}

                <div class="category" style="background-color: {{ note.category.color }}">
                    <h2>{{ note.category }}</h2>
                </div>

                {% include 'date_and_author.html' %}

            </div>
        </div>
    </div>

    <div class="editor-container" tabindex="-1">
        <form method="post" tabindex="-1">
            {% csrf_token %}
            <div class="note-content">
                <textarea tabindex="-1" id="markdown-editor-{{ note_id }}"
                          name="content">{{ form.content.value }}</textarea>
            </div>

            <!-- невидимая кнопка-->
            <button type="submit">Сохранить изменения</button>
        </form>

        <script src="https://cdn.jsdelivr.net/simplemde/latest/simplemde.min.js"></script>
        <script>
            let simplemde = new SimpleMDE({
                element: document.getElementById("markdown-editor-{{ note_id }}"),
                spellChecker: false,
                placeholder: "Начните писать здесь...",
                autosave: {
                    enabled: true,
                    uniqueId: "MyUniqueID-{{ note_id }}",
                    delay: 1000,
                },
                initialValue: document.getElementById("markdown-editor-{{ note_id }}").value,
                toolbar: [
                    "bold", "italic", "heading",
                    "quote", "unordered-list", "ordered-list",
                    "link", "image", "code"
                ],
            });
        </script>
    </div>

    <!-- Модальное окно для подтверждения удаления -->
    {% include 'modal_delete_note.html' %}

    <!-- для подтверждения удаления -->
    <script src="{% static 'noteapp/js/delete_confirmation.js' %}"></script>

    <!-- для нажатия невидимой кнопки сохранения через иконку save.svg -->
    <script src="{% static 'noteapp/js/click_save_button.js' %}"></script>

    <!-- для вставки 4-х пробелов при нажатии tab  (doesn't work) -->
    <script src="{% static 'noteapp/js/insert_four_spaces.js' %}"></script>

    <!-- для копирования в буфер -->
    <script src="{% static 'noteapp/js/copy_to_clipboard.js' %}"></script>

    <!-- Отключение tabindex на всей странице -->
    <script src="{% static 'noteapp/js/disable_tabindex.js' %}"></script>

    <!-- для подсчета ширины и медленного появления note-panel -->
    <script src="{% static 'noteapp/js/show_note_panel.js' %}"></script>

{% endblock %}
